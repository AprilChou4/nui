Nui.define("{cpns}/router",function(){return this.extend("component",{static:{_trigger:!1,_domain:location.protocol+"//"+location.host,_paths:{},_params:{},_alias:{},_cache:{},_cacheContainer:{},_replace:function(t){return t.replace(this._domain,"").replace(/^\#\!?/,"").replace(/^([^\/])/,"/$1").replace(/\/$/g,"")},alias:function(t){return $.extend(this._alias,t||{})},_setCache:function(t){var e=this,t=e._oldhash;t&&Nui.each(e._cacheContainer,function(n,a){if(a===t)return e._cache[t]=n.html(),!1})},_change:function(){var t=this,e=location.hash,n=t._replace(e);$.isEmptyObject(t._paths)&&$.isEmptyObject(t._params)||(t._setCache(),Nui.each([t._paths,t._params],function(a,r){var i=!1;if(Nui.each(a,function(a){if(0===r&&n===a.path||1===r&&0===n.indexOf(a.path)){var c=n.replace(a.path,"").replace(/^\//,"");if(c=c?c.split("/"):[],c.length===a.params.length){var o={};Nui.each(a.params,function(t,e){o[t]=c[e]}),t._cacheContainer[e]=a.container;var h=t._cache[e];return a.render(a.target,a.container,{path:a.path,url:n,param:o,cache:h}),t._trigger=i=!0,!1}}}),i)return!1}),t._trigger||Nui.each(t._instances,function(e){if(!0===e.options.enter)return e.target.eq(0).trigger("click"),t._trigger=!0,!1})),t._oldhash=e},_bindHashchange:function(){var t=this;if(Nui.bsie7){var e=function(e){var n=location.hash;return t._oldhash!==n&&!e};setInterval(function(){e()&&t._change()},100),e(!0)}else Nui.win.on("hashchange",function(){t._change()})},trigger:function(){this._trigger||this._change()},$ready:null},options:{path:"",container:null,enter:!1,onBefore:null,onRender:null},_init:function(){var t=this,e=t.constructor;t._exec()&&!e._bind&&(e._bind=!0,e._bindHashchange())},_exec:function(){var t=this,e=t.options,n=t.constructor;if(t.path=t._setpath(e.path),t.target=t._getTarget(),t.container=$(e.container),e.path&&t.target){var a=t._getpath();if(a.params.length){var r=[];Nui.each(a.params,function(t){r.push(t);var e=r.join("/:");n._params[a.path+"/:"+e]=$.extend({},a,{params:e.split("/:")})}),n._params[t.path]=a}else n._paths[t.path]=a;return t._event()}},_setpath:function(t){var e=this.constructor;return(t=Nui.trim(t))&&Nui.each(e._alias,function(e,n){t=t.replace(new RegExp("{"+n+"}","g"),e)}),e._replace(t)},_getpath:function(){var t=this,e=t.path,n=t.options,a=e.indexOf("/:"),r={target:t.target,container:t.container,params:[]};return-1!==a?(r.params=e.substr(a+2).split("/:"),r.path=e.substr(0,a)):r.path=e,r.render="function"==typeof n.onRender?n.onRender:$.noop,r},_sethash:function(t){location.hash="#!"+this.constructor._replace(t)},_event:function(){var t=this,e=t.options;return t._on("click",t.target,function(n,a){var r=function(){t._sethash(a.attr("href"))};return("function"!=typeof e.onBefore||!1!==e.onBefore(a,r))&&(r(),!1)}),t},_reset:function(){var t=this,e=t.constructor;return t._off(),delete e._paths[t.path],delete e._params[t.path],t}})}),Nui.define("./script/page",["{cpns}/router"],function(t){});