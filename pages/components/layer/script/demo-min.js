Nui.define("{cpns}/layer/layer",["component","util"],function(e,t){var n={_maskzIndex:1e4,_zIndex:1e4,_mask:null,_init:function(){},$fn:null,$ready:null,init:null},i={content:"",width:300,height:"auto",maxWidth:0,maxHeight:0,edge:10,timer:0,container:"body",title:"温馨提示",animate:"",isMove:!0,isMask:!0,isClickMask:!1,isMoveMask:!1,isClose:!0,isCenter:!0,isFull:!1,isTop:!1,isFixed:!0,scrollbar:!0,bubble:{enable:!1,dir:"top"},iframe:{enable:!1,cache:!1,src:""},offset:{top:null,right:null,bottom:null,left:null},close:{enable:!0,text:"×"},confirm:{enable:!1,text:"确定",callback:function(){return!0}},cancel:{enable:!1,text:"取消"},bottom:null,button:null,onMove:null,onResize:null,onScroll:null,onClick:null};return this.extend(e,{static:n,options:i,_template:{layout:'<div class="<% className %>"><div class="layer-box"><% if close %><% var btn = close %><% include "button" %><% /if %><% if title %><div class="layer-head"><span class="layer-title"><% title %></span></div><% /if %><div class="layer-body"><div class="layer-main"><% content %></div></div><% if button && button.length %><div class="layer-foot"><% each button btn %><% include "button" %><% /each %></div><% /if %></div></div>',button:'<span class="nui-button layer-button layer-button-<% btn.id %>"><% btn.text || "匿名按钮" %></span>',iframe:'<iframe<% each attr %> <% $index %>="<% $value %>"<% /each %>></iframe>',mask:NaN},_init:function(){var e=this.constructor;this._zIndex=++e._zIndex,this._exec()},_exec:function(){var e=this,t=e.options,n=e.constructor;if(e._container=n._jquery(t.container),e._container.length){if("BODY"!==e._container.get(0).tagName){t.isFixed=!1;var i=e._container.css("position");"absolute"!==i&&"relative"!==i&&e._container.css("position","relative")}e._create()}},_create:function(){var e=this,t=e.options,n=e._createButton(),i=e._tplData({content:e._getContent(),close:n.close,button:n.button,title:t.title});e.element=$(e._tpl2html("layout",i)).appendTo(e._container);var o=e.element.box=e.element.children(".layer-box");e.element.head=o.children(".layer-head"),e.element.body=o.children(".layer-body"),e.element.main=e.element.body.children(".layer-main"),e.element.foot=o.children(".layer-foot"),e._iframe&&(e.element.iframe=e.element.main.children("iframe"),e._iframeOnload()),!0===t.isMove&&t.title&&e._move(),e._button.length&&e._buttonEvent(),t.isTop&&e._setTop(),e._show()},_getContent:function(){var e=this,t=e.options,n="";return t.iframe&&!0===t.iframe.enable&&t.iframe.src?e._iframe=n=e._createIframe():"string"==typeof t.content?n=t.content:t.content instanceof jQuery&&(n=t.content.prop("outerHTML")),n},_createIframe:function(){var e=this,n=(e.options,"layer-iframe"+e.__index);return!1===i.iframe.cache&&(src=t.setParam("_",(new Date).getTime(),src)),e._tpl2html("iframe",{frameborder:"0",name:n,id:n,src:src,scroll:"hidden",style:"width:100%;"})},_iframeOnload:function(){var e=this;e.element.iframe.load(function(){e._resize()})},_createButton:function(){var e=this,t=e.options,n={},i={},o={};return e._button=[],Nui.each(["confirm","cancel"],function(e){var i=t[e];i&&!0===i.enable&&(n[e]={id:e,text:i.text,callback:i.callback})}),t.button&&t.button.length&&Nui.each(t.button,function(t){var i=t.id;o[i]||(o[i]=!0,n[i]&&delete n[i],e._button["close"===i?"unshift":"push"](t))}),Nui.each(n,function(t){e._button.push(t)}),!o.close&&t.close&&!0===t.close.enable&&e._button.unshift({id:"close",text:t.close.text,callback:t.close.callback}),e._button[0]&&"close"===e._button[0].id?(i.close=e._button[0],i.button=e._button.slice(1)):i.button=e._button,i},_buttonEvent:function(){var e=this;Nui.each(e._button,function(t){e._on("click",e.element,"nui-button-"+t.id,function(n,i){var o=t.id,a=t.callback,l="function"==typeof a?a.call(e,n,i):null;("confirm"===o&&!0===l||"confirm"!==o&&!1!==l)&&e.destroy()})})},_setTop:function(){var e=this;e._on("click",e.element,function(){e.setzIndex()})},_move:function(){var e,t,n,i,o=this,a=o.options,l=o.element,s=o.constructor,c=l,r=!1;o._on("mousedown",l.head,function(n,i){r=!0,o._setzIndex(),!0===a.isMoveMask&&(c=o._moveMask=$(o._tpl2html("mask",{name:"movemask",skin:a.skin,zindex:o._zIndex+1})),!0!==a.isFixed||Nui.bsie6||c.css("position","fixed"),c.css({width:o._data.width-s.getSize(c,"lr"),height:o._data.height-s.getSize(c),top:o._data.top,left:o._data.left})),i.css("cursor","move"),e=n.pageX-o._data.left,t=n.pageY-o._data.top,n.stopPropagation()}),o._on("mousemove",Nui.doc,function(a){var l=Nui.doc.width(),s=Nui.doc.height();if(r)return n=a.pageX-e,i=a.pageY-t,n<0&&(n=0),i<0&&(i=0),n+o._data.width>l&&(n=l-o._data.width),i+o._data.height>s&&(i=s-o._data.height),o._data.top=i,o._data.left=n,c.css({top:i,left:n}),!r}),o._on("mouseup",Nui.doc,function(e){r&&(r=!1,l.head.css("cursor","default"),n=n||o._data.left,i=i||o._data.top,!0===a.isMoveMask&&(!l.is(":animated")&&l.animate({top:i,left:n},300),o._moveMask.remove()),Nui.bsie6&&!0===a.isFixed&&(o._data.winTop=i-Nui.win.scrollTop(),o._data.winLeft=i-Nui.win.scrollLeft()),"function"==typeof a.onMove&&a.onMove.call(this))})},_setzIndex:function(){var e=this,t=e.constructor;e._downing||(e._downing=!0,e._zIndex=++t._zIndex,e.element.css("zIndex",e._zIndex),Nui.each(t.__instances,function(t){t&&t!==e&&(t._downing=!1)}))},_resize:function(){var e=this;e.options,e.element},_show:function(){var t=this,n=t.options,i=(t.element,t.element.main);return t._resize(),e("init",i),"function"==typeof n.onInit&&n.onInit.call(this,i,t.__index),t},resize:function(){var e=this,t=e.options,n=(e.element,e.element.main);return e._resize(),"function"==typeof t.onResize&&t.onResize.call(this,n,e.__index),e},hide:function(){this.destroy()},destroy:function(){var t=this,n=t.constructor,o=t.options,a=!0,l=t.element.main;e("destroy",l),t._reset(),t._delete(),n._zIndex--,Nui.each(n.__instances,function(e){if(e&&1==e.options.isMask&&"BODY"===e._container.eq(0).tagName)return a=!1}),a&&n._mask&&(n._mask.remove(),n._mask=null),t._mask&&t._mask.remove(),i.timer>0&&clearTimeout(t._timer),"function"==typeof o.onDestroy&&o.onDestroy.call(this,l,t.__index)}})}),Nui.define("./script/demo",function(require,imports,renders,extend){var e=require("{cpns}/layer/layer");e({content:"<a>aaa</a>",confirm:{enable:!0},cancel:{enable:!0},button:[{id:"cancel"},{id:"confirm"}]})});