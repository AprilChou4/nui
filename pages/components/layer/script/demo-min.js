Nui.define("{cpns}/layer/layer",["component","util"],function(e,t){var n={_maskzIndex:1e4,_zIndex:1e4,_mask:null,_init:function(){},$fn:null,$ready:null,init:null},o={content:"",width:300,height:"auto",maxWidth:0,maxHeight:0,edge:10,timer:0,container:"body",title:"温馨提示",animate:"",isMove:!0,isMask:!0,isClickMask:!1,isMoveMask:!1,isClose:!0,isCenter:!0,isFull:!1,isTop:!1,isFixed:!0,scrollbar:!0,bubble:{enable:!1,dir:"top"},iframe:{enable:!1,cache:!1,src:""},offset:{top:null,right:null,bottom:null,left:null},close:{enable:!0,text:"×"},confirm:{enable:!1,text:"确定",callback:function(){return!0}},cancel:{enable:!1,text:"取消"},bottom:null,button:null,onMove:null,onResize:null,onScroll:null,onClick:null};return this.extend(e,{static:n,options:o,_template:{layout:'<div class="<% className %>"><div class="layer-box"><% if close %><% var btn = close %><% include "button" %><% /if %><% if title %><div class="layer-head"><span class="layer-title"><% title %></span></div><% /if %><div class="layer-body"><div class="layer-main"><% content %></div></div><% if button && button.length %><div class="layer-foot"><% each button btn %><% include "button" %><% /each %></div><% /if %></div></div>',button:'<span class="nui-button layer-button layer-button-<% btn.id %>"><% btn.text || "匿名按钮" %></span>',iframe:'<iframe<% each attr %> <% $index %>="<% $value %>"<% /each %>></iframe>',mask:NaN},_init:function(){var e=this.constructor;this._zIndex=++e._zIndex,this._exec()},_exec:function(){var e=this,t=e.options,n=e.constructor;if(e._container=n._jquery(t.container),e._container.length){if("BODY"!==e._container.get(0).tagName){t.isFixed=!1;var o=e._container.css("position");"absolute"!==o&&"relative"!==o&&e._container.css("position","relative")}e._create()}},_create:function(){var e=this,t=e.options,n=e._createButton(),o=e._tplData({content:e._getContent(),close:n.close,button:n.button,title:t.title});e.element=$(e._tpl2html("layout",o)).appendTo(e._container);var i=e.element.box=e.element.children(".layer-box");e.element.head=i.children(".layer-head"),e.element.body=i.children(".layer-body"),e.element.main=e.element.body.children(".layer-main"),e.element.foot=i.children(".layer-foot"),e._iframe&&(e.element.iframe=e.element.main.children("iframe"),e._iframeOnload()),!0===t.isMove&&t.title&&e._move(),e._button.length&&e._buttonEvent(),t.isTop&&e._setTop(),e._show()},_getContent:function(){var e=this,t=e.options,n="";return t.iframe&&!0===t.iframe.enable&&t.iframe.src?e._iframe=n=e._createIframe():"string"==typeof t.content?n=t.content:t.content instanceof jQuery&&(n=t.content.prop("outerHTML")),n},_createIframe:function(){var e=this,n=(e.options,"layer-iframe"+e.__index);return!1===o.iframe.cache&&(src=t.setParam("_",(new Date).getTime(),src)),e._tpl2html("iframe",{frameborder:"0",name:n,id:n,src:src,scroll:"hidden",style:"width:100%;"})},_iframeOnload:function(){var e=this;e.element.iframe.load(function(){e._resize()})},_createButton:function(){var e=this,t=e.options,n={},o={},i={};return e._button=[],Nui.each(["confirm","cancel"],function(e){var o=t[e];o&&!0===o.enable&&(n[e]={id:e,text:o.text,callback:o.callback})}),t.button&&t.button.length&&Nui.each(t.button,function(t){var o=t.id;i[o]||(i[o]=!0,n[o]&&delete n[o],e._button["close"===o?"unshift":"push"](t))}),Nui.each(n,function(t){e._button.push(t)}),!i.close&&t.close&&!0===t.close.enable&&e._button.unshift({id:"close",text:t.close.text,callback:t.close.callback}),e._button[0]&&"close"===e._button[0].id?(o.close=e._button[0],o.button=e._button.slice(1)):o.button=e._button,o},_buttonEvent:function(){var e=this;Nui.each(e._button,function(t){e._on("click",e.element,"nui-button-"+t.id,function(n,o){var i=t.id,a=t.callback,l="function"==typeof a?a.call(e,n,o):null;("confirm"===i&&!0===l||"confirm"!==i&&!1!==l)&&e.destroy()})})},_setTop:function(){var e=this;e._on("click",e.element,function(){e.setzIndex()})},_move:function(){var e,t,n,o,i=this,a=i.options,l=i.element,s=i.constructor,c=l,r=!1;i._on("mousedown",l.head,function(n,o){r=!0,i._setzIndex(),!0===a.isMoveMask&&(c=i._moveMask=$(i._tpl2html("mask",{name:"movemask",skin:a.skin,zindex:i._zIndex+1})),!0!==a.isFixed||Nui.bsie6||c.css("position","fixed"),c.css({width:i._owner.width-s.getSize(c,"lr"),height:i._owner.height-s.getSize(c),top:i._owner.top,left:i._owner.left})),o.css("cursor","move"),e=n.pageX-i._owner.left,t=n.pageY-i._owner.top,n.stopPropagation()}),i._on("mousemove",Nui.doc,function(a){var l=$(this).width(),s=$(this).height();if(r)return n=a.pageX-e,o=a.pageY-t,n<0&&(n=0),o<0&&(o=0),n+i._owner.width>l&&(n=l-i._owner.width),o+i._owner.height>s&&(o=s-i._owner.height),i._owner.top=o,i._owner.left=n,c.css({top:o,left:n}),!r}),i._on("mouseup",Nui.doc,function(e){r&&(r=!1,l.head.css("cursor","default"),n=n||i._owner.left,o=o||i._owner.top,!0===a.isMoveMask&&(!l.is(":animated")&&l.animate({top:o,left:n},300),i._moveMask.remove()),Nui.bsie6&&!0===a.isFixed&&(i._owner.winTop=o-Nui.win.scrollTop(),i._owner.winLeft=o-Nui.win.scrollLeft()),"function"==typeof a.onMove&&a.onMove.call(this))})},_setzIndex:function(){var e=this,t=e.constructor;e._downing||(e._downing=!0,e._zIndex=++t._zIndex,e.element.css("zIndex",e._zIndex),Nui.each(t.__instances,function(t){t&&t!==e&&(t._downing=!1)}))},_resize:function(){var e=this;e.options,e.element},_show:function(){var t=this,n=t.options;t.element;return t._resize(),e("init",t.element.main),"function"==typeof n.onInit&&n.onInit.call(this),t},resize:function(){var e=this,t=e.options;e.element;return e._resize(),"function"==typeof t.onResize&&t.onResize.call(this),e},hide:function(){this.destroy()},destroy:function(){var t=this,n=t.constructor,i=t.options,a=!0;e("destroy",t.element.main),t._reset(),t._delete(),n._zIndex--,Nui.each(n.__instances,function(e){if(e&&1==e.options.isMask&&"BODY"===e._container.eq(0).tagName)return a=!1}),a&&n._mask&&(n._mask.remove(),n._mask=null),t._mask&&t._mask.remove(),o.timer>0&&clearTimeout(t._timer),"function"==typeof i.onDestroy&&i.onDestroy.call(this)}})}),Nui.define("./script/demo",function(require,imports,renders,extend){var e=require("{cpns}/layer/layer");e({content:"<a>aaa</a>",confirm:{enable:!0},cancel:{enable:!0},button:[{id:"cancel"},{id:"confirm"}]})});