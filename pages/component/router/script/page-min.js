Nui.define("{cpns}/router",function(){return this.extend("component",{static:{_trigger:!1,_domain:location.protocol+"//"+location.host,_paths:{},_params:{},_alias:{},_replace:function(t){return t.replace(this._domain,"").replace(/^\#\!?/,"").replace(/^([^\/])/,"/$1").replace(/\/*$/g,"")},alias:function(t){return $.extend(this._alias,t||{})},_change:function(){var t=this,e=t._replace(location.hash);$.isEmptyObject(t._paths)&&$.isEmptyObject(t._params)||(Nui.each([t._paths,t._params],function(a,n){var r=!1;if(Nui.each(a,function(a){if(0===n&&e===a.path||1===n&&0===e.indexOf(a.path)){var i=e.replace(a.path,"").replace(/^\//,"");if(i=i?i.split("/"):[],i.length===a.params.length){var o={};return Nui.each(a.params,function(t,e){o[t]=i[e]}),a.render(a.target,{path:a.path,param:o}),t._trigger=r=!0,!1}}}),r)return!1}),t._trigger||Nui.each(t._instances,function(e){if(!0===e.options.enter)return e.target.eq(0).trigger("click"),t._trigger=!0,!1}))},_bindHashchange:function(){var t=this;if(Nui.bsie7){var e=function(e){var a=location.hash;return t._oldhash!==a&&(t._oldhash=a,!e)};setInterval(function(){e()&&t._change()},100),e(!0)}else Nui.win.on("hashchange",function(){t._change()})},trigger:function(){this._trigger||this._change()},$ready:null},options:{path:"",enter:!1,onBefore:null,onRender:null},_init:function(){var t=this,e=t.constructor;t._exec()&&!e._bind&&(e._bind=!0,e._bindHashchange())},_exec:function(){var t=this,e=t.options,a=t.constructor;if(t.path=t._setpath(e.path),t.target=t._getTarget(),e.path&&t.target){var n=t._getpath();return n.params.length?a._params[t.path]=n:a._paths[t.path]=n,t._event()}},_setpath:function(t){var e=this.constructor;return(t=Nui.trim(t))&&Nui.each(e._alias,function(e,a){t=t.replace(new RegExp("{"+a+"}","g"),e)}),e._replace(t)},_getpath:function(){var t=this,e=t.path,a=t.options,n=e.indexOf("/:"),r={target:t.target,params:[]};return-1!==n?(r.params=e.substr(n+2).split("/:"),r.path=e.substr(0,n)):r.path=e,r.render="function"==typeof a.onRender?a.onRender:$.noop,r},_sethash:function(t){t=this.constructor._replace(t),location.hash="#!"+t},_event:function(){var t=this,e=t.options;return t._on("click",t.target,function(a){if("function"==typeof e.onBefore&&!1===e.onBefore())return!1;var n=$(this);return t._sethash(n.attr("href")),!1}),t},_reset:function(){var t=this,e=t.constructor;return t._off(),delete e._paths[t.path],delete e._params[t.path],t}})}),Nui.define("./script/page",["{cpns}/router","util","template"],function(t,e,a){var n=this.renders,r=function(t,e){e.text=t.text(),$(".content").html(a.render(n('这是<% text %><% if path === \'/photo/nui/\' && param.id %>子分类页面<%/if%> ，页面url是<% path %>，<% if !param.id && path !== \'/home\' %><a href="<% path %>/1111/" class="child f-cblue">子页面</a><% if path === \'/photo\' %><a href="<% path %>/nui/" id="nui" class="f-cblue"> 子分类</a><% /if %><% /if %><% if param.id %>这是子页面，传递的参数是 <% each param %><% $index %>：<% $value %>，<% /each %><% /if %>'),e))};t({target:"#home",path:"/home/",enter:!0,onRender:r}),t({target:"#news",path:"/news/",onRender:r}),t({target:".child",path:"/news/:id/",onRender:r}),t({target:"#photo",path:"/photo/",onRender:r}),t({target:".child",path:"/photo/:id/",onRender:r}),t({target:"#nui",path:"/photo/nui/",onRender:r}),t({target:".child",path:"/photo/nui/:id/",onRender:r}),t({target:"#about",path:"/about/",onRender:r}),t("trigger")});