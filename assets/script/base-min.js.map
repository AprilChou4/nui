{"version":3,"sources":["base-debug.js"],"names":["Nui","define","this","extend","static","_init","that","doc","on","_active","each","__instances","val","element","find","removeClass","_getcode","type","text","_getarr","match","code","array","v","index","indexOf","sub","substr","length","push","_comment","test","replace","options","tools","copy","isLight","isLine","isTitle","_exec","target","_getTarget","dom","get","tagName","html","remove","_create","_event","_title","_template","opts","data","$","bsie7","list","_list","title","_tplData","_tpl2html","insertAfter","_getCode","split","mapping","click tr","click .copy","callback","active","e","elem","constructor","addClass","siblings","stopPropagation","alert","self","str","trim","RegExp","js","css","res","v1","v2","k2","istag","preBlank","tagname","toLowerCase","exports","call","xml","imports","hash","location","main","items","menus","init","setYear","event","position","Date","getFullYear","scrollTop","top","scroll","stop","i","item","id","itop","ntop","next","eq","outerHeight","removeAttr","attr"],"mappings":"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","file":"base-min.js.map?v=1498549838703","sourcesContent":["/**\r\n * @author Aniu[2017-03-02 08:44]\r\n * @update Aniu[2017-03-02 08:44]\r\n * @version 1.0.1\r\n * @description 语法高亮组件\r\n */\r\n\r\nNui.define('highlight',function(){\r\n    return this.extend('component', {\r\n        static:{\r\n            _init:function(){\r\n                var that = this;\r\n                Nui.doc.on('click', function(){\r\n                    if(that._active){\r\n                        Nui.each(that.__instances, function(val){\r\n                            if(val._active){\r\n                                val.element.find('tr.s-crt').removeClass('s-crt');\r\n                                val._active = false;\r\n                            }\r\n                        })\r\n                    }\r\n                    that._active = false;\r\n                })\r\n            },\r\n            _getcode:function(type, text){\r\n                return '<code class=\"'+ type +'\">'+ text +'</code>'\r\n            },\r\n            _getarr:function(match, code){\r\n                var array = [];\r\n                if(!match){\r\n                    array.push(code)\r\n                }\r\n                else{\r\n                    Nui.each(match, function(v){\r\n                        var index = code.indexOf(v);\r\n                        var sub = code.substr(0, index);\r\n                        code = code.substr(index+v.length);\r\n                        array.push(sub);\r\n                        array.push(v);\r\n                    })\r\n                    array.push(code);\r\n                }\r\n                return array\r\n            },\r\n            _comment:function(code){\r\n                //多行注释\r\n                if(/\\/\\*/.test(code)){\r\n                    code = code.replace(/(\\/\\*(.|\\s)*?\\*\\/)/g, this._getcode('comment', '$1'))\r\n                }\r\n                //单行注释\r\n                else if(/\\/\\//.test(code)){\r\n                    code = code.replace(/(\\/\\/.*)$/g, this._getcode('comment', '$1'))\r\n                }\r\n                return code\r\n            }\r\n        },\r\n        options:{\r\n            //工具栏\r\n            tools:{\r\n                //复制\r\n                copy:true\r\n            },\r\n            //点击代码那一行高亮\r\n            isLight:true,\r\n            //是否显示行号\r\n            isLine:false,\r\n            //是否显示语法标题\r\n            isTitle:true\r\n        },\r\n        _init:function(){\r\n            this._exec();\r\n        },\r\n        _exec:function(){\r\n            var that = this, target = that._getTarget();\r\n            if(target){\r\n                var dom = target.get(0);\r\n                if(dom.tagName === 'SCRIPT' && dom.type == 'text/highlight'){\r\n                    that.code = target.html()\r\n                                .replace(/^[\\r\\n]+|[\\r\\n]+$/g, '')\r\n                                .replace(/</g, '&lt;')\r\n                                .replace(/>/g, '&gt;');\r\n                    if(that.element){\r\n                        that.element.remove();\r\n                    }\r\n                    that._create();\r\n                    if(that.options.isLight){\r\n                        that._event();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _title:'',\r\n        _template:\r\n            '<div class=\"<% className %>\">'\r\n                +'<%if tools%>'\r\n                +'<div class=\"tools\">'\r\n                    +'<%if tools.copy%>'\r\n                    +'<em class=\"copy\">复制</em>'\r\n                    +'<%/if%>'\r\n                +'</div>'\r\n                +'<%/if%>'\r\n                +'<div class=\"body\">'\r\n                    +'<table>'\r\n                        +'<%each list val key%>'\r\n                            +'<tr>'\r\n                                +'<%if isLine === true%><td class=\"line\" number=\"<%key+1%>\"><%if bsie7%><%key+1%><%/if%></td><%/if%>'\r\n                                +'<td class=\"code\"><%val%></td>'\r\n                            +'</tr>'\r\n                        +'<%/each%>'\r\n                    +'</table>'\r\n                +'</div>'\r\n                +'<%if isTitle%>'\r\n                +'<em class=\"title\"><%title%></em>'\r\n                +'<%/if%>'\r\n            +'</div>',\r\n        _create:function(){\r\n            var that = this;\r\n            var opts = that.options;\r\n            var data = $.extend({\r\n                bsie7:Nui.bsie7,\r\n                list:that._list(),\r\n                title:that._title,\r\n                isLine:opts.isLine,\r\n                tools:opts.tools,\r\n                isTitle:opts.isTitle\r\n            }, that._tplData())\r\n            that.element = $(that._tpl2html(data)).insertAfter(that.target);\r\n        },\r\n        _getCode:function(){\r\n            return this.code\r\n        },\r\n        _list:function(){\r\n            return this._getCode().split('\\n')\r\n        },\r\n        mapping:{\r\n            'click tr':'active',\r\n            'click .copy':'copy'\r\n        },\r\n        callback:{\r\n            active:function(e, elem){\r\n                this.constructor._active = this._active = true;\r\n                elem.addClass('s-crt').siblings().removeClass('s-crt');\r\n                e.stopPropagation()\r\n            },\r\n            copy:function(){\r\n                alert('傻帽！逗你玩呢。')\r\n            }\r\n        }\r\n    })\r\n})\r\n\n/**\r\n * @author Aniu[2017-03-02 08:44]\r\n * @update Aniu[2017-03-02 08:44]\r\n * @version 1.0.1\r\n * @description css语法高亮组件\r\n */\r\n\r\nNui.define('src/components/highlight/style',function(){\r\n    return this.extend('highlight', {\r\n        _title:'css',\r\n        _getCode:function(){\r\n            var that = this;\r\n            var code = that.code;\r\n            var self = that.constructor;\r\n            var str = '';\r\n            var match = code.match(/(\\/\\*(.|\\s)*?\\*\\/)|(\\{[^\\{\\}\\/]*\\})/g);\r\n            var array = self._getarr(match, code);\r\n            Nui.each(array, function(v){\r\n                if(Nui.trim(v)){\r\n                    //多行注释\r\n                    if(/^\\s*\\/\\*/.test(v)){\r\n                        v = v.replace(/(.+)/g, self._getcode('comment', '$1'))\r\n                    }\r\n                    else{\r\n                        //匹配属性\r\n                        if(/\\}\\s*$/.test(v)){\r\n                            v = v.replace(/(\\s*)([^:;\\{\\}\\/\\*]+)(:)([^:;\\{\\}\\/\\*]+)/g, '$1'+self._getcode('attr', '$2')+'$3'+self._getcode('string', '$4'))\r\n                                .replace(/([\\:\\;\\{\\}])/g, self._getcode('symbol', '$1'));\r\n                        }\r\n                        //选择器\r\n                        else{\r\n                            v = v.replace(/([^\\:\\{\\}\\@\\#\\s\\.]+)/g, self._getcode('selector', '$1'))\r\n                                .replace(/([\\:\\{\\}\\@\\#\\.])/g, self._getcode('symbol', '$1'));\r\n                        }\r\n                    }\r\n                }\r\n                str += v;\r\n            })\r\n            return str\r\n        }\r\n    })\r\n})\r\n\n/**\r\n * @author Aniu[2017-03-02 08:44]\r\n * @update Aniu[2017-03-02 08:44]\r\n * @version 1.0.1\r\n * @description javascript语法高亮组件\r\n */\r\n\r\nNui.define('src/components/highlight/javascript',function(){\r\n    return this.extend('highlight', {\r\n        _title:'js',\r\n        _getCode:function(){\r\n            var that = this;\r\n            var code = that.code;\r\n            var self = that.constructor;\r\n            var str = '';\r\n            var kws = 'abstract|arguments|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|elseif|each|enum|eval|export|'+\r\n                      'extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|include|interface|let|long|native|new|null|'+\r\n                      'package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|var';\r\n            var symbol = '&lt;|&gt;|;|!|%|\\\\\\|\\\\\\[|\\\\\\]|\\\\\\(|\\\\\\)|\\\\\\{|\\\\\\}|\\\\\\=|\\\\\\/|-|\\\\\\+|,|\\\\\\.|\\\\\\:|\\\\\\?|~|\\\\\\*|&';\r\n            var match = code.match(/(\\/\\/.*)|(\\/\\*(.|\\s)*?\\*\\/)|('[^']*')|(\"[^\"]*\")/g);\r\n            var array = self._getarr(match, code);\r\n            Nui.each(array, function(v){\r\n                if($.trim(v)){\r\n                    //单行注释\r\n                    if(/^\\s*\\/\\//.test(v)){\r\n                        v = self._getcode('comment', v);\r\n                    }\r\n                    //多行注释\r\n                    else if(/^\\s*\\/\\*/.test(v)){\r\n                        v = v.replace(/(.+)/g, self._getcode('comment', '$1'))\r\n                    }\r\n                    else{\r\n                        //字符串\r\n                        if(/'|\"/.test(v)){\r\n                            v = v.replace(/(.+)/g, self._getcode('string', '$1'))\r\n                        }\r\n                        //关键字、符号、单词\r\n                        else{\r\n                            v = v.replace(new RegExp('('+ symbol +')', 'g'), self._getcode('symbol', '$1'))\r\n                                .replace(new RegExp('('+ kws +')(\\\\s+|\\\\\\<code)', 'g'), self._getcode('keyword', '$1')+'$2')\r\n                                .replace(/(\\/code>\\s*)(\\d+)/g, '$1'+self._getcode('number', '$2'))\r\n                                .replace(/(\\/code>\\s*)?([^<>\\s]+)(\\s*<code)/g, '$1'+self._getcode('word', '$2')+'$3')\r\n\r\n                        }\r\n                        v = self._comment(v);\r\n                    }\r\n                }\r\n                str += v;\r\n            })\r\n            return str\r\n        }\r\n    })\r\n})\r\n\n/**\r\n * @author Aniu[2017-03-02 08:44]\r\n * @update Aniu[2017-03-02 08:44]\r\n * @version 1.0.1\r\n * @description xml语法高亮组件\r\n */\r\n\r\nNui.define('{light}/xml',['src/components/highlight/javascript', 'src/components/highlight/style'],function(js, css){\r\n    return this.extend('highlight', {\r\n        _title:'xml',\r\n        _getCode:function(){\r\n            var that = this;\r\n            var code = that.code;\r\n            var self = that.constructor;\r\n            var str = '';\r\n            code = code.replace(/&lt;\\s*![^!]+-\\s*&gt;/g, function(res){\r\n                return res.replace(/&lt;/g, '<<').replace(/&gt;/g, '>>')\r\n            });\r\n            Nui.each(code.split('&lt;'), function(v1){\r\n                v1 = v1.split('&gt;');\r\n                var length = v1.length;\r\n                Nui.each(v1, function(v2, k2){\r\n                    if(Nui.trim(v2)){\r\n                        if(k2 == 0){\r\n                            var istag = false;\r\n                            if(/^\\s*\\//.test(v2)){\r\n                                v2 = v2.replace(/([^\\r\\n\\/]+)/g, self._getcode('tag', '$1'))\r\n                                       .replace(/^(\\s*\\/+)/, self._getcode('symbol', '$1'))\r\n                            }\r\n                            else{\r\n                                var preBlank = v2.match(/^\\s+/)||'';\r\n                                if(/\\=\\s*['\"]$/.test(v2)){\r\n                                    istag = true\r\n                                }\r\n                                v2 = v2.replace(/^\\s+/, '')\r\n                                       .replace(/(\\s+)([^'\"\\/\\s\\=]+)((\\s*=\\s*)(['\"]?[^'\"]*['\"]?))?/g, '$1'+self._getcode('attr', '$2')+self._getcode('symbol', '$4')+self._getcode('string', '$5'))\r\n                                       .replace(/<code class=\"\\w+\">(\\s*((<<\\s*![-\\s]+)|([-\\s]+>>))?)<\\/code>/g, '$1')\r\n                                       .replace(/^([^\\s]+)/, self._getcode('tag', '$1'))\r\n                                       .replace(/(\\/+\\s*)$/, self._getcode('symbol', '$1'))\r\n                                v2 = preBlank + v2;\r\n                            }\r\n                            v2 = self._getcode('symbol', '&lt;') + v2;\r\n                            if(!istag){\r\n                                v2 += self._getcode('symbol', '&gt;');\r\n                            }\r\n                        }\r\n                        else{\r\n                            //闭合标签\r\n                            if(length === 3 && k2 === 1 && /\\s*['\"]\\s*/.test(v2)){\r\n                                v2 = v2.replace(/(\\s*['\"]\\s*)/, self._getcode('symbol', '$1')) + self._getcode('symbol', '&gt;');\r\n                            }\r\n                            //内容\r\n                            else{\r\n                                var tagname = $.trim(v1[0]).toLowerCase();\r\n                                if(tagname == 'style'){\r\n                                    v2 = css.exports._getCode.call(that, v2)\r\n                                }\r\n                                else if(tagname == 'script'){\r\n                                    v2 = js.exports._getCode.call(that, v2)\r\n                                }\r\n                                else{\r\n                                    v2 = v2.replace(/(.+)/g, self._getcode('text', '$1'))\r\n                                }\r\n                            }\r\n                        }\r\n                        //注释\r\n                        v2 = v2.replace(/<<\\s*![^!]+-\\s*>>/g, function(res){\r\n                            return res.replace(/([^\\r\\n]+)/g, self._getcode('comment', '$1')).replace(/<</g, '&lt;').replace(/>>/g, '&gt;')\r\n                        })\r\n                    }\r\n                    str += v2\r\n                })\r\n            })\r\n\r\n            return str\r\n        }\r\n    })\r\n})\r\n\nNui.define('{script}/base',['{light}/xml'], function(xml){\r\n    this.imports('../style/base');\r\n    var hash = location.hash.replace('#', '');\r\n    var main = $('.g-main');\r\n    var items = main.find('h2');\r\n    var length = items.length;\r\n    var menus = $('.m-menu ul');\r\n\r\n    return ({\r\n        init:function(){\r\n            this.setYear();\r\n            if(main.find('h2[id]').length){\r\n                this.event();\r\n                this.position();\r\n            }\r\n        },\r\n        setYear:function(){\r\n            $('#nowyear').text('-'+new Date().getFullYear());\r\n        },\r\n        position:function(){\r\n            if(hash){\r\n                var elem = $('[id=\"'+ hash +'\"]');\r\n                elem.length && main.scrollTop(elem.position().top)\r\n            }\r\n        },\r\n        event:function(){\r\n            main.scroll(function(){\r\n                var stop = main.scrollTop();\r\n                items.each(function(i){\r\n                    var item = $(this);\r\n                    var id = this.id;\r\n                    var itop = item.position().top - 20;\r\n                    var ntop = 0;\r\n                    var next = items.eq(i+1);\r\n                    if(next.length){\r\n                        ntop = next.position().top - 20\r\n                    }\r\n                    else{\r\n                        ntop = $('.mainbox').outerHeight()\r\n                    }\r\n                    menus.find('a.s-crt').removeClass('s-crt');\r\n                    if(stop >= itop && stop < ntop){\r\n                        menus.find('a[href=\"#'+ id +'\"]').addClass('s-crt');\r\n                        //为了阻止设置location.hash时，浏览器会自行定位到该id的起始位置\r\n                        item.removeAttr('id');\r\n                        location.hash = id;\r\n                        item.attr('id', id);\r\n                        return false;\r\n                    }\r\n                })\r\n            })\r\n        }\r\n    })\r\n})\r\n\n"]}